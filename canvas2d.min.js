function _setContainer(e,t){e.width=t.width,e.height=t.height,e.stage=t.container,e.canvas.width=t.width,e.canvas.height=t.height,e.ctx=e.canvas.getContext("2d")}var Canvas2d={globalId:1,container:{id:0,width:0,height:0,element:null},fakeCtx:null};Canvas2d.Stage=function(e,t,n,r){this.enabledEvent=r===!1?r:!0,this.className="Stage",this.visible=!0,this.date=new Date,this.name="Stage_"+this.date.getTime().toString(),this.indexCount=0,this.container=document.getElementById(e),this.container.style.width=t+"px",this.container.style.height=n+"px",this.container.style.position="absolute",this.container.onmousedown=function(){},Canvas2d.container.id=e,Canvas2d.container.width=t,Canvas2d.container.height=n,Canvas2d.container.element=this.container,this.fakeCanvas=document.createElement("canvas"),this.fakeCanvas.width=t,this.fakeCanvas.height=n,this.fakeCtx=this.fakeCanvas.getContext("2d"),Canvas2d.fakeCtx=this.fakeCtx,this.width=t,this.height=n,this.x=0,this.y=0,this.alpha=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.id=e,this.index=0,this.children=[],this.evtListeners={};var i=navigator.userAgent.toLowerCase();this.agent=i,this.enabledEvent&&("ontouchstart"in window?this._functestmobile():this._functest()),window.fire||(window.fire=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),window.cancelFire=function(e){return window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||function(e){window.clearTimeout(e)}}(),window.rqanim={time:0,timeInterval:0,startTime:0,lastTime:0,frame:0,animating:!1,loop:[],prId:0,whipe:function(){this.loop=[]},getLoop:function(){return this.loop},getTime:function(){return this.time},getFps:function(){return this.timeInterval>0?1e3/this.timeInterval:0},getFrame:function(){return this.frame},getTimeInterval:function(){return this.timeInterval},_animationLoop:function(){if(this.animating){var e=this;this.frame++;var t=new Date,n=t.getTime();this.timeInterval=n-this.lastTime,this.time+=this.timeInterval,this.lastTime=n;for(var r=0;r<this.loop.length;r++){var i=this.loop[r];i.func.apply(i.target,[i.target])}window.fire(function(){e._animationLoop()})}},start:function(){if(!this.animating){var e=new Date;this.startTime=e.getTime(),this.lastTime=this.startTime,this.animating=!0,this._animationLoop()}},reset:function(){this.time=0,this.timeInterval=0,this.startTime=0,this.lastTime=0,this.frame=0;var e=new Date;this.startTime=e.getTime(),this.lastTime=this.startTime},stop:function(){this.animating=!1},addLoop:function(e,t){return this.isChild(e)||(this.prId++,this.start(),e.PRID=this.prId,this.loop.push({target:e,func:t,id:this.prId})),this.prId},isChild:function(e){var t=-1;for(var n=0;n<this.loop.length;n++)if(this.loop[n].target===e){t=n;break}return t>-1?!0:!1},removeLoop:function(e){var t=-1;for(var n=0;n<this.loop.length;n++)if(this.loop[n].id===e.PRID){t=n;break}t>-1&&this.loop.splice(t,1),this.loop.length===0&&this.stop()},_init:function(){var e=new Date;this.startTime=e.getTime(),this.lastTime=this.startTime,this.animating=!0,this._animationLoop()}})},Canvas2d.Stage.prototype={enableEvt:function(){"ontouchstart"in window?this._functestmobile():this._functest(),this.enabledEvent=!0},disableEvt:function(){"ontouchstart"in window?(this.container.removeEventListener("touchmove",this._evtData[0],!1),this.container.removeEventListener("touchstart",this._evtData[0],!1),this.container.removeEventListener("touchend",this._evtData[0],!1)):(this.container.removeEventListener("mousemove",this._evtData[0],!1),this.container.removeEventListener("mousedown",this._evtData[0],!1),this.container.removeEventListener("mouseup",this._evtData[0],!1),this.container.removeEventListener("click",this._evtData[0],!1),this.container.removeEventListener("mouseover",this._evtData[1],!1),this.container.removeEventListener("mouseout",this._evtData[1],!1)),this.enabledEvent=!1},addLoop:function(e,t){window.rqanim.addLoop(e,t)},removeLoop:function(e){window.rqanim.removeLoop(e)},start:function(){window.rqanim.start()},reset:function(){window.rqanim.reset()},stop:function(){window.rqanim.animating=!1},getFrame:function(){return window.rqanim.getFrame()},getTime:function(){return window.rqanim.getTime()},getFps:function(){return window.rqanim.getFps()},getTimeInterval:function(){return window.rqanim.getTimeInterval()},getLoopList:function(){return window.rqanim.loop},isAnimating:function(){return window.rqanim.animating},getDataURL:function(e,t){var n=e?e:"image/jpeg",r=t?t:5;this.fakeCtx.save(),this.draw(this.fakeCtx),this.fakeCtx.restore();var i=this.fakeCanvas.toDataURL(n,r);this.fakeCtx.clearRect(0,0,this.width,this.height);var s=document.createElement("img");return s.src=i,s},addEvent:function(e,t){e in this.evtListeners?this.evtListeners[e].func.push(t):this.evtListeners[e]={func:[t]}},removeEvent:function(e,t){if(e in this.evtListeners){for(var n=0;n<this.evtListeners[e].func.length;n++)if(this.evtListeners[e].func[n]===t){this.evtListeners[e].func.splice(n,1);break}this.evtListeners[e].func.length===0&&delete this.evtListeners[e]}},add:function(e){if(e.parent||e.className==="DisplayObjects")return;e.index=this.indexCount,e.parent=this,this._setContainer(e,this),this.children.push(e),this.indexCount++,this._orderCanvases()},remove:function(e){if(e.parent!==this)return;e.parent=undefined,this.children.splice(e.index,1),this.container.removeChild(e.canvas),this.indexCount--;for(var t=0;t<this.children.length;t++)this.children[t].index=t;this._orderCanvases()},zOrder:function(e,t){if(e.parent!==this)return;if(typeof t=="string"){var n=this.children.length,r=t==="top"?n-1:t==="bottom"?0:n-1;this.children.splice(e.index,1),this.children.splice(r,0,e);for(var i=0;i<n;i++)this.children[i].index=i;this._orderCanvases()}else if(t in this.children){this.children.splice(e.index,1),this.children.splice(t,0,e);for(var i=0;i<this.children.length;i++)this.children[i].index=i;this._orderCanvases()}},_setContainer:function(e,t){e.width=t.width,e.height=t.height,e.stage=t.container,e.canvas.width=t.width,e.canvas.height=t.height,e.ctx=e.canvas.getContext("2d")},_orderCanvases:function(){function t(n){for(var r=0;r<n.length;r++)n[r].className==="Sprite"?e.container.appendChild(n[r].canvas):t(n[r].children)}var e=this;t(this.children)},resize:function(e,t){this.container.style.width=e+"px",this.container.style.height=t+"px",this.width=e,this.height=t;for(var n=0;n<this.children.length;n++)this._setContainer(this.children[n],this)},_functestmobile:function(){function k(t){t.preventDefault(),C.touchend=!1,C.click=!1,C.dragstop=!1,C.gestureend=!1,C.touchmove=t.type==="touchmove"?!0:!1,t.type==="touchstart"?C.touchstart=!0:C.touchstart&&t.type==="touchend"&&(C.touchstart=!1,C.touchend=!0,C.click=!0,d=!1,m=!1,E=!1,w=!1,b=1,y=0,g=0),C.touchmove&&L(t)?(a?e._testdetect(t.touches[0],a)&&e._testdetect(t.touches[1],a)?(T=a,N=f):T=N=!1:T=N=!1,d=m?!1:!0,v=!0):C.touchmove&&a&&(w=E?!1:!0,S=!0),d&&(m=!0),w&&a&&(E=!0),!w&&!E&&S&&C.touchend&&(C.dragstop=!0,S=!1);if(N||T)d&&N?M(t,N,t):m&&N&&O(t,N,t),d&&T?M(t,T,t):m&&T&&O(t,T,t);d?M(t,e,t):m?O(t,e,t):v&&A(P(t),"gestureend",t),!d&&!m&&v&&C.touchend&&(C.gestureend=!0,v=!1);if(w&&f){var n=e._parentOffset(P(t),f.parent);h=n.ox-f.x,p=n.oy-f.y,_(t,f,n)}else E&&f&&D(P(t),f,t,h,p);if(w&&a){var r=e._parentOffset(P(t),a.parent);l=r.ox-a.x,c=r.oy-a.y,_(t,a,r)}else E&&a&&D(P(t),a,t,l,c);for(var i in C)if(C[i])switch(i){case"touchend":H(P(t),i,"mouseup",t);break;case"touchstart":H(P(t),i,"mousedown",t);break;case"touchmove":H(P(t),i,"mousemove",t);break;default:H(P(t),i,"none",t)}}function L(e){return e.type!=="touchend"&&e.touches.length===2?!0:!1}function A(t,r,i){if(r in e.evtListeners){u=e._parentOffset(t,e);for(n=0;n<e.evtListeners[r].func.length;n++)e.evtListeners[r].func[n].apply(e,[{target:e,mouse:u,type:r,event:i}])}}function O(t,r,i){if("gesturechange"in r.evtListeners){var o=r===e?e:r.parent,u,a;u=e._parentOffset(t.touches[0],o),a=e._parentOffset(t.touches[1],o);var f,l,c,h;l=Math.sqrt(Math.pow(u.x-a.x,2)+Math.pow(u.y-a.y,2)),f=Math.atan2(u.y-a.y,u.x-a.x),c=b*(l/g),h=f-y,u.mouse2=a,u.scale=c,u.angle=h;for(n=0;n<r.evtListeners.gesturechange.func.length;n++)r.evtListeners.gesturechange.func[n].apply(s,[{target:r,mouse:u,type:"gesturechange",event:t}])}}function M(t,r,i){var o=r===e?e:r.parent,u,a;u=e._parentOffset(t.touches[0],o),a=e._parentOffset(t.touches[1],o),g=Math.sqrt(Math.pow(u.x-a.x,2)+Math.pow(u.y-a.y,2)),y=Math.atan2(u.y-a.y,u.x-a.x)-r.rotation,b=(r.scaleX+r.scaleY)/2;if("gesturestart"in r.evtListeners){u.mouse2=a,u.scale=b,u.angle=y;for(n=0;n<r.evtListeners.gesturestart.func.length;n++)r.evtListeners.gesturestart.func[n].apply(s,[{target:r,mouse:u,type:"gesturestart",event:t}])}}function _(e,t,r){if("dragstart"in t.evtListeners)for(n=0;n<t.evtListeners.dragstart.func.length;n++)t.evtListeners.dragstart.func[n].apply(s,[{target:t,mouse:r,type:"dragstart",event:e}])}function D(t,r,i,o,u){if("drag"in r.evtListeners){var a=e._parentOffset(t,r.parent),f,l;f=a.ox-o,l=a.oy-u,a.ox=f,a.oy=l;for(n=0;n<r.evtListeners.drag.func.length;n++)r.evtListeners.drag.func[n].apply(s,[{target:r,mouse:a,type:"drag",event:i}])}}function P(e){var t={pageX:0,pageY:0};return e.touches&&e.touches.length>0?t=e.touches[0]:e.changedTouches&&e.changedTouches.length>0&&(t=e.changedTouches[0]),t}function H(u,l,c,h,p){for(t=e.children.length-1;t>-1;t--){i=e.children[t];if(i.visible&&i.enabledEvent){for(r=i.children.length-1;r>-1;r--){s=i.children[r];if(s.visible&&s.enabledEvent){var d=e._testdetect(u,s);if(d){if(l in s.evtListeners)for(n=0;n<s.evtListeners[l].func.length;n++)s.evtListeners[l].func[n].apply(s,[{target:s,mouse:d,type:l,event:h}]);if(c in s.evtListeners)for(n=0;n<s.evtListeners[c].func.length;n++)s.evtListeners[c].func[n].apply(s,[{target:s,mouse:d,type:c,event:h}]);a=s,o=!0;break}}a=o=!1}if(o&&d){var v=e._testdetect(u,i);if(l in i.evtListeners)for(n=0;n<i.evtListeners[l].func.length;n++)i.evtListeners[l].func[n].apply(i,[{target:i,mouse:v,type:l,event:h}]);if(c in i.evtListeners)for(n=0;n<i.evtListeners[c].func.length;n++)i.evtListeners[c].func[n].apply(i,[{target:i,mouse:v,type:c,event:h}]);f=i,d=v=!1;break}f=!1}}}this.container.addEventListener("touchmove",k,!1),this.container.addEventListener("touchstart",k,!1),this.container.addEventListener("touchend",k,!1);var e=this,t,n,r,i,s,o=!1,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C={touchstart:null,touchend:null,touchmove:null,gestureend:null,dragstop:!1,click:!1};this._evtData=[k]},_functest:function(){function w(m){m.type==="mouseout"&&f&&B(m,f),m.type==="mouseout"&&l&&B(m,c),t=n=r=i=s=o=u=a=f=l=c=h=p=v=d=!1,e={mouseup:!1,mousedown:!1,mousemove:!1,click:!1,mouseover:!1,mouseout:!1,dragstart:!1,drag:!1,dragstop:!1}}function E(t){t.preventDefault(),P(t),e.click=!1,e.mouseup=!1,e.dragstop=!1,e.dragstart=!1,e.mousemove=t.type==="mousemove"?!0:!1,N(t),T(t),t.type==="mousedown"?e.mousedown=!0:t.type==="mouseup"&&e.mousedown&&(e.mousedown=!1,e.click=!0,e.mouseup=!0,o=!1,s=!1),e.mousemove&&e.mousedown&&a&&(s=o?!1:!0,u=!0),s&&a&&(o=!0),!s&&!o&&u&&e.mouseup&&(e.dragstop=!0,e.drag=!1,u=!1,e.click=!1);if(x(t)||S(t))for(var n in e)e[n]&&I(t,n)}function S(e){if(s&&l){var t=C._parentOffset(e,l.parent);y=t.ox-l.x,b=t.oy-l.y,j(e,l,t)}else{if(!o||!l)return!0;F(e,l,y,b)}return!1}function x(e){if(s&&a){var t=C._parentOffset(e,a.parent);m=t.ox-a.x,g=t.oy-a.y,j(e,a,t)}else{if(!o||!a)return!0;F(e,a,m,g)}return!1}function T(e){h=l?!0:!1,p=c?c===l?!1:!0:!1,p?d||(d=!0,B(e,c),v=!1):h&&(v||(v=!0,H(e,l),d=!1)),c=h?l:c}function N(e){r=a?!0:!1,i=f?f===a?!1:!0:!1,i?n||(n=!0,B(e,f),t=!1):r&&(t||(t=!0,H(e,a),n=!1)),f=r?a:f}function P(e){if(e.type in C.evtListeners){D=C._parentOffset(e,C);for(L=0;L<C.evtListeners[e.type].func.length;L++)C.evtListeners[e.type].func[L].apply(C,[{target:C,mouse:D,type:e.type,event:e}])}}function H(e,t){if("mouseover"in t.evtListeners){D=C._parentOffset(e,t.parent);for(L=0;L<t.evtListeners.mouseover.func.length;L++)t.evtListeners.mouseover.func[L].apply(M,[{target:t,mouse:D,type:"mouseover",event:e}])}}function B(e,t){if(t&&"mouseout"in t.evtListeners){D=C._parentOffset(e,t.parent);for(L=0;L<t.evtListeners.mouseout.func.length;L++)t.evtListeners.mouseout.func[L].apply(M,[{target:t,mouse:D,type:"mouseout",event:e}])}}function j(e,t,n){if("dragstart"in t.evtListeners)for(L=0;L<t.evtListeners.dragstart.func.length;L++)t.evtListeners.dragstart.func[L].apply(M,[{target:t,mouse:n,type:"dragstart",event:e}])}function F(e,t,n,r){if("drag"in t.evtListeners){var i=C._parentOffset(e,t.parent),s,o;s=i.ox-n,o=i.oy-r,i.ox=s,i.oy=o;for(L=0;L<t.evtListeners.drag.func.length;L++)t.evtListeners.drag.func[L].apply(M,[{target:t,mouse:i,type:"drag",event:e}])}}function I(e,t,n){for(k=C.children.length-1;k>-1;k--){O=C.children[k];if(O.visible&&O.enabledEvent){for(A=O.children.length-1;A>-1;A--){M=O.children[A];if(M.visible&&M.enabledEvent){D=C._testdetect(e,M);if(D){if(t in M.evtListeners)for(L=0;L<M.evtListeners[t].func.length;L++)M.evtListeners[t].func[L].apply(M,[{target:M,mouse:D,type:t,event:e}]);a=M,_=!0;break}}a=_=!1}if(_&&D){if(t in O.evtListeners)for(L=0;L<O.evtListeners[t].func.length;L++)O.evtListeners[t].func[L].apply(O,[{target:O,mouse:D,type:t,event:e}]);l=O,D=!1;break}l=!1}}}this.container.addEventListener("mousemove",E,!1),this.container.addEventListener("mousedown",E,!1),this.container.addEventListener("mouseup",E,!1),this.container.addEventListener("click",E,!1),this.container.addEventListener("mouseover",w,!1),this.container.addEventListener("mouseout",w,!1);var e={mouseup:!1,mousedown:!1,mousemove:!1,click:!1,mouseover:!1,mouseout:!1,dragstart:!1,drag:!1,dragstop:!1},t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=0,g=0,y,b;this._evtData=[E,w];var C=this,k,L,A,O,M,_=!1,D},_testdetect:function(e,t){var n,r,i,s,o,u,a,f,l,c=this.container.getBoundingClientRect();return r=e.pageX-(Math.floor(c.left)+window.pageXOffset),i=e.pageY-(Math.floor(c.top)+window.pageYOffset),n=t.parent._global(),f=t.className==="Sprite"?r/n.scaleX:r,l=t.className==="Sprite"?i/n.scaleY:i,o=Math.sqrt(Math.pow(f-n.x,2)+Math.pow(l-n.y,2)),s=Math.atan2(i-n.y,r-n.x)-n.rotation,u=Math.cos(s)*o,a=Math.sin(s)*o,this.fakeCtx.save(),this.fakeCtx.translate(n.x,n.y),this.fakeCtx.scale(n.scaleX,n.scaleY),this.fakeCtx.rotate(n.rotation),t.draw(this.fakeCtx,!0),this.fakeCtx.restore(),this.fakeCtx.isPointInPath(r,i)?{x:r,y:i,ox:u,oy:a,gx:n.x,gy:n.y,scaleX:n.scaleX,scaleY:n.scaleY,rotation:n.rotation}:!1},_parentOffset:function(e,t){var n,r,i,s,o,u,a,f,l,c=this.container.getBoundingClientRect();return n=t._global(),r=e.pageX-(Math.floor(c.left)+window.pageXOffset),i=e.pageY-(Math.floor(c.top)+window.pageYOffset),f=t.className==="Sprite"?r/n.scaleX:r,l=t.className==="Sprite"?i/n.scaleY:i,s=Math.sqrt(Math.pow(f-n.x,2)+Math.pow(l-n.y,2)),o=Math.atan2(i-n.y,r-n.x)-n.rotation,u=Math.cos(o)*s,a=Math.sin(o)*s,{x:r,y:i,ox:u,oy:a,gx:n.x,gy:n.y,scaleX:n.scaleX,scaleY:n.scaleY,rotation:n.rotation}},_global:function(){return{x:this.x,y:this.y,scaleX:this.scaleX,scaleY:this.scaleY,rotation:this.rotation,alpha:this.alpha,visible:this.visible}},clear:function(){for(var e=0;e<this.children.length;e++)this.children[e].clear()},draw:function(e){for(var t=0;t<this.children.length;t++)this.children[t].draw(e)}},Canvas2d.Sprite=function(e,t){this.enabledEvent=t===!1?t:!0,this.visible=!0,this.name=e?e:"",this.id="sprite_"+(Canvas2d.globalId++).toString()+"_"+this.name;var n=Canvas2d.container;this.width=n.width,this.height=n.height;var r=document.createElement("canvas");r.width=this.width,r.height=this.height,r.id=this.id,r.style.position="absolute",r.style.top="0px",r.style.left="0px",this.canvas=r,this.ctx=r.getContext("2d"),this.stage=n.element,this.className="Sprite",this.indexCount=0,this.date=new Date,this.children=[],this.index=0,this.parent=null,this.x=0,this.y=0,this.alpha=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.evtListeners={}},Canvas2d.Sprite.prototype={addEvent:function(e,t){e in this.evtListeners?this.evtListeners[e].func.push(t):this.evtListeners[e]={func:[t]}},removeEvent:function(e,t){if(e in this.evtListeners){for(var n=0;n<this.evtListeners[e].func.length;n++)if(this.evtListeners[e].func[n]===t){this.evtListeners[e].func.splice(n,1);break}this.evtListeners[e].func.length===0&&delete this.evtListeners[e]}},add:function(e){if(e.parent||e.className!=="DisplayObjects")return;e.parent=this,e.index=this.indexCount,this.indexCount++,this.children.push(e)},remove:function(e){if(e.parent!==this)return;e.parent=undefined,this.children.splice(e.index,1),this.indexCount--;for(var t=0;t<this.children.length;t++)this.children[t].index=t},getBound:function(){function s(e,t){return e-t}var e=[],t=[],n=[],r=[];for(var i=0;i<this.children.length;i++)e.push(this.children[i].x+this.children[i].width),t.push(this.children[i].y+this.children[i].height);return e.sort(s),t.sort(s),{width:e[e.length-1],height:t[t.length-1]}},zOrder:function(e){if(typeof e=="string"){var t=this.parent.children.length,n=e==="top"?t-1:e==="bottom"?0:t-1;this.parent.children.splice(this.index,1),this.parent.children.splice(n,0,this);for(var r=0;r<t;r++)this.parent.children[r].index=r;this.parent._orderCanvases()}else if(e in this.parent.children){this.parent.children.splice(this.index,1),this.parent.children.splice(e,0,this);for(var r=0;r<this.parent.children.length;r++)this.parent.children[r].index=r;this.parent._orderCanvases()}},clear:function(){this.ctx.clearRect(0,0,this.width,this.height)},_global:function(){var e=this.parent._global(),t,n;if(this.parent.rotation!==0){var r=Math.atan2(this.y,this.x)+this.parent.rotation,i=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));t=i*Math.cos(r),n=i*Math.sin(r)}else t=this.x,n=this.y;return{x:e.x+t,y:e.y+n,scaleX:e.scaleX*this.scaleX,scaleY:e.scaleY*this.scaleY,rotation:e.rotation+this.rotation,alpha:e.alpha<1?this.alpha*e.alpha:this.alpha,visible:e.visible?this.visible:!1}},clone:function(){var e=new Canvas2d.Sprite;for(var t=0;t<this.children.length;t++){var n=this.children[t].clone(this.children[t].name);e.add(n)}return e},draw:function(e){if(!this.visible){this.clear();return}var t=e?e:this.ctx;e||this.clear();var n=this._global();t.save(),t.translate(n.x,n.y),t.scale(n.scaleX,n.scaleY),t.rotate(n.rotation),t.globalAlpha=n.alpha;for(var r=0;r<this.children.length;r++)this.children[r].draw(t);t.restore()}},Canvas2d.DisplayObjects=function(e,t){this.enabledEvent=t===!1?t:!0,this.visible=!0,this.className="DisplayObjects",this.evtListeners={},this.parent=null,this.name=e?e:"",this.id="displayObjects_"+(Canvas2d.globalId++).toString()+"_"+this.name,this.index=0,this.type="",this.x=0,this.y=0,this.width=0,this.height=0,this.localX=0,this.localY=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.alpha=1,this.lineAlpha=1,this.color=null,this.lineColor=null,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.lineMiter=10,this.backUpImage=null,this.imageData=null,this.imageCrop={dw:-1,dh:-1,dx:0,dy:0},this.doneimage=!1,this.currentFilter=null},Canvas2d.DisplayObjects.prototype={txt:"",close:!0,fontStyle:null,fontSize:10,fontType:"Verdana",fontWeigth:"normal",align:"center",baseLine:"alphabetic",backGround:null,paddingLeft:0,paddingTop:0,source:null,loadComplete:!1,isLoading:!1,image:null,frameList:null,currentFrame:0,shadow:null,lineShadow:null,gradient:null,lineGradient:null,_alignList:{start:"start",end:"end",left:"left",right:"right",center:"center"},_baseList:{top:"top",hanging:"hanging",middle:"middle",alphabetic:"alphabetic",ideographic:"ideographic",bottom:"bottom"},_capList:{butt:"butt",round:"round",square:"square"},_joinList:{bevel:"bevel",round:"round",miter:"miter"},addEvent:function(e,t){e in this.evtListeners?this.evtListeners[e].func.push(t):this.evtListeners[e]={func:[t]}},removeEvent:function(e,t){if(e in this.evtListeners){for(var n=0;n<this.evtListeners[e].func.length;n++)if(this.evtListeners[e].func[n]===t){this.evtListeners[e].func.splice(n,1);break}this.evtListeners[e].func.length===0&&delete this.evtListeners[e]}},zOrder:function(e){if(typeof e=="string"){var t=this.parent.children.length,n=e==="top"?t-1:e==="bottom"?0:t-1;this.parent.children.splice(this.index,1),this.parent.children.splice(n,0,this);for(var r=0;r<t;r++)this.parent.children[r].index=r}else if(e in this.parent.children){this.parent.children.splice(this.index,1),this.parent.children.splice(e,0,this);for(var r=0;r<this.parent.children.length;r++)this.parent.children[r].index=r}},getColor:function(e){var t=e?e:"rgb";return this._parseGetColor(this.color,t)},getLineColor:function(e){var t=e?e:"rgb";return this._parseGetColor(this.lineColor,t)},_parseColor:function(e){if(!e)return console.log(e," isn't a valid value."),undefined;if(typeof e=="string"){var t=e.replace(/\s/g,"").toLowerCase(),n,r;if(t.indexOf("rgb")>-1)return t;if(t.indexOf("#")>-1){var i=Colors.Rgb(t);return"rgb("+i[0]+","+i[1]+","+i[2]+")"}if(t.indexOf("hsl")>-1){n=/[hsla\(\)]/g,r=t.replace(n,"").split(",");var s=Colors.HslToRgb(parseFloat(r[0])/360,parseFloat(r[1])/100,parseFloat(r[2])/100);return"rgb("+s[0]+","+s[1]+","+s[2]+")"}if(t.indexOf("hsv")>-1){n=/[hsv\(\)]/g,r=t.replace(n,"").split(",");var o=Colors.HsvToRgb(parseInt(r[1]),parseInt(r[2]),parseInt(r[3]));return"rgb("+o[0]+","+o[1]+","+o[2]+")"}return t in Colors.namedColor?(r=Colors.namedColor[t][1],"rgb("+r[0]+","+r[1]+","+r[2]+")"):(console.log(e," isn't a valid value."),"rgb(0,0,0)")}return"rgb("+e[0]+","+e[1]+","+e[2]+")"},_parseGetColor:function(e,t){if(!e)return console.log(e," isn't a valid value."),"rgb(0,0,0)";var n=this._parseColor(e),r=/[rgbhslva\(\)]/g,i=n.replace(r,"").split(","),s=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2])],o,u=s;switch(t){case"hex":u=Colors.Hex(u);break;case"rgb":u=n;break;case"hsl":o=Colors.RgbToHsl(s[0],s[1],s[2]),u="hsl("+o[0]*360+","+o[1]*100+"%,"+o[2]*100+"%)";break;case"hsv":o=Colors.RgbToHsv(s[0],s[1],s[2]),u="hsv("+o[0]*360+","+o[1]*100+"%,"+o[2]*100+"%)";break;case"name":function a(e,t,n){var r=t-n<=e&&t+n>=e?!0:!1;return r}var f=2;for(var l in Colors.namedColor)if(a(Colors.namedColor[l][1][0],u[0],f)&&a(Colors.namedColor[l][1][1],u[1],f)&&a(Colors.namedColor[l][1][2],u[2],f)){u=l;break}break;case"array":u=s;break;default:u=n}return u},cacheAsBitmap:function(){var e={polygon:"polygon",shape:"shape",text:"text",rect:"rect",rectround:"rectround",line:"line",circle:"circle"};if(!(this.type in e)){console.log("wrong type ",this.type);return}var t=document.createElement("canvas"),n=this.x,r=this.y,i=this.rotation,s=new Image;t.width=this.width+this.lineWidth*2,t.height=this.height+this.lineWidth*2;var o=t.getContext("2d");this.type==="polygon"||this.type==="shape"?(n=this.x-this.width/2,r=this.y-this.height/2,this.x=Math.abs(this._coord.x[0])+this.lineWidth,this.y=Math.abs(this._coord.y[0])+this.lineWidth):(this.x=0,this.y=0),this.rotation=0,this.draw(o);var u=t.toDataURL("image/png",10);s.src=u,this.img(0,0,s,!0),this.x=n,this.y=r,this.rotation=i},clone:function(e){var t=new Canvas2d.DisplayObjects(e),n=Object.prototype.toString;for(var r in this)if(n.call(this[r])!=="[object Function]")switch(r){case"id":break;case"parent":break;case"name":break;default:if(n.call(this[r])==="[object Object]"){var i={};for(var s in this[r])i[s]=this[r][s];t[r]=i}else t[r]=this[r]}return t},rect:function(e,t,n,r,i,s,o){this.type="rect",this.x=this.localX=e,this.y=this.localY=t,this.width=n,this.height=r,this._setStyle(i,s,o)},rectRound:function(e,t,n,r,i,s,o,u){this.type="rectround",this.x=this.localX=e,this.y=this.localY=t,this.width=n,this.height=r,this.radius=i,this._setStyle(s,o,u)},polygon:function(e,t,n,r,i,s,o){function l(e,t){return e-t}function c(e,t){return e>0?t-e:t<0?Math.abs(e+t):Math.abs(e)+t}this.type="polygon",this.close=o===!1?o:!0,this.x=this.localX=e,this.y=this.localY=t,this.points=n,this._setStyle(r,i,s);var u=[],a=[];for(var f=0;f<this.points.length;f++)u.push(this.points[f][0]+this.localX),a.push(this.points[f][1]+this.localY);u.sort(l),a.sort(l),this.width=c(u[0],u[u.length-1]),this.height=c(a[0],a[a.length-1]),this._coord={x:u,y:a}},shape:function(e,t,n,r,i,s,o){function h(e,t){return e-t}function p(e,t){return e>0?t-e:t<0?Math.abs(e+t):Math.abs(e)+t}this.type="shape",this.close=o===!1?o:!0,this.x=this.localX=e,this.y=this.localY=t,this.obj=n,this._setStyle(r,i,s);var u=[],a=[];for(var f=0;f<this.obj.length;f++)for(var l in this.obj[f]){var c=this.obj[f][l];switch(l){case"moveTo":u.push(this.localX+c[0]),a.push(this.localY+c[1]);break;case"lineTo":u.push(this.localX+c[0]),a.push(this.localY+c[1]);break;case"quadraticCurveTo":u.push(this.localX+c[0]),a.push(this.localY+c[1]),u.push(this.localX+c[2]),a.push(this.localY+c[3]);break;case"bezierCurveTo":u.push(this.localX+c[0]),a.push(this.localY+c[1]),u.push(this.localX+c[2]),a.push(this.localY+c[3]),u.push(this.localX+c[4]),a.push(this.localY+c[5]);break;case"arcTo":u.push(this.localX+c[0]),a.push(this.localY+c[1]),u.push(this.localX+c[2]),a.push(this.localY+c[3]);break;default:}}u.sort(h),a.sort(h),this.width=p(u[0],u[u.length-1]),this.height=p(a[0],a[a.length-1]),this._coord={x:u,y:a}},line:function(e,t,n,r,i,s,o,u,a,f,l){function d(e,t){return e-t}function v(e,t){return e>0?t-e:t<0?Math.abs(e+t):Math.abs(e)+t}this.type="line",this.x=this.localX=e,this.y=this.localY=t,this.points=[[n,r],[i,s]];var c=[],h=[];for(var p=0;p<this.points.length;p++)c.push(this.points[p][0]+this.localX),h.push(this.points[p][1]+this.localY);c.sort(d),h.sort(d),this.width=v(c[0],c[c.length-1]),this.height=v(h[0],h[h.length-1]),this._coord={x:c,y:h},this.len=Math.sqrt(Math.pow(n+i,2)+Math.pow(r+s,2)),this._setStyle(null,o,u,a,f,l)},circle:function(e,t,n,r,i,s,o,u){this.type="circle",this.x=this.localX=e,this.y=this.localY=t,this.width=n*2,this.height=n*2,this.radius=n,this.startAngle=r,this.endAngle=i,this._setStyle(s,o,u)},text:function(e,t,n,r,i,s,o,u,a,f){this.type="text",this.x=this.localX=t,this.y=this.localY=n;var l=Canvas2d.fakeCtx;this.height=i?i:10,this.txt=e?e:"",this.backGround=u?u:null,this._setFont(r,i,s,a,f),this._setStyle(o),l.font=this.fontStyle,l.textAlign=this.align,l.textBaseline=this.baseLine,this.width=l.measureText(e).width,delete l},img:function(e,t,n,r,i,s,o,u){this.type="img",this.x=this.localX=e,this.y=this.localY=t,this.paddingLeft=s?s:0,this.paddingTop=o?o:0,this._setStyle(i),this.setCrop(u),this.source=n?n:null,r&&this.loadImage(this.source,null,null,r)},clip:function(e,t,n,r,i){this.type="clip",this.x=this.localX=e,this.y=this.localY=t,this.source=n?n:null,this.frameList=r?r:this.frameList,i&&this.loadImage(this.source,null,null,i)},restore:function(){this.doneimage=!1},setCrop:function(e){if(!e)return;for(var t in this.imageCrop)this.imageCrop[t]=e[t]?e[t]:this.imageCrop[t];this.doneimage=!1},roulette:function(e,t,n,r,i,s){var i=i/360*Math.PI*2,o,u,a=0,f=0,l=[],c=e*r,h=t*r,p=n*r;console.log(360/i*t);while(f<=360/i*t)s==="Epicycloid"&&(o=(c+h)*Math.cos(a)-h*Math.cos((c+h)/h*a),u=(c+h)*Math.sin(a)-h*Math.sin((c+h)/h*a)),s==="Epitrochoid"&&(o=(c+h)*Math.cos(a)-p*Math.cos((c+h)/h*a),u=(c+h)*Math.sin(a)-p*Math.sin((c+h)/h*a)),s==="Hypocycloid"&&(o=(c-h)*Math.cos(a)+h*Math.cos((c-h)/h*a),u=(c-h)*Math.sin(a)-h*Math.sin((c-h)/h*a)),s==="Hypotrochoid"&&(o=(c-h)*Math.cos(a)+p*Math.cos((c-h)/h*a),u=(c-h)*Math.sin(a)-p*Math.sin((c-h)/h*a)),a+=i,f++,l.push([o,u]);return l},filter:function(e,t){this.backUpImage&&(this.imageData=this.backUpImage);var n=document.createElement("canvas");n.width=this.width,n.height=this.height;var r=n.getContext("2d");r.drawImage(this.imageData,0,0,this.width,this.height);var i=r.getImageData(0,0,this.width,this.height);switch(e){case"invert":i=this._filterInvert(i),this.currentFilter="invert";break;case"grayscale":i=this._filterGrayscale(i),this.currentFilter="grayscale";break;case"hsl":i=this._filterHsl(i,t),this.currentFilter="hsl";break;case"pixelated":i=this._filterPixelated(i,t,n),this.currentFilter="pixelated";break;case"cut":var s=t[1];t=t.length===4?t:Colors.ParseColor(t[0]),i=this._filterCut(i,t,s),this.currentFilter="cut";break;default:this.currentFilter=null}r.putImageData(i,0,0),this.imageData=n,this.parent.draw()},_filterPixelated:function(e,t,n){var r=e.data,i=t?t[0]:2;for(var s=0;s<n.height;s+=i)for(var o=0;o<n.width;o+=i){var u=r[(n.width*s+o)*4],a=r[(n.width*s+o)*4+1],f=r[(n.width*s+o)*4+2];for(var l=0;l<i;l++)for(var c=0;c<i;c++)o+c<n.width&&(r[(n.width*(s+l)+(o+c))*4]=u,r[(n.width*(s+l)+(o+c))*4+1]=a,r[(n.width*(s+l)+(o+c))*4+2]=f)}return e},_filterGrayscale:function(e){var t=e.data;for(var n=0;n<t.length;n+=4){var r=.34*t[n]+.5*t[n+1]+.16*t[n+2];t[n]=r,t[n+1]=r,t[n+2]=r}return e},_filterInvert:function(e){var t=e.data;for(var n=0;n<t.length;n+=4)t[n]=255-t[n],t[n+1]=255-t[n+1],t[n+2]=255-t[n+2];return e},_filterCut:function(e,t,n){function s(e,t,r){return r>=e-t&&r<=e+t?Math.floor(255*Math.abs((e-r)/n)):255}var r=e.data,i=0;for(var o=0;o<r.length;o+=4)i=s(r[o],n,t[0])+s(r[o+1],n,t[1])+s(r[o+2],n,t[2]),r[o+3]=Math.floor(i/3);return e},_filterHsl:function(e,t){var n=e.data;for(var r=0;r<n.length;r+=4){var i=Colors.RgbToHsl(n[r],n[r+1],n[r+2]),s=i[0]+t[0]/100<=0?0:i[0]+t[0]/100>=120?120:i[0]+t[0]/100,o=i[1]+t[1]/100<=0?0:i[1]+t[1]/100>=100?100:i[1]+t[1]/100,u=i[2]+t[2]/100<=0?0:i[2]+t[2]/100>=100?100:i[2]+t[2]/100,a=Colors.HslToRgb(s,o,u);n[r]=a[0],n[r+1]=a[1],n[r+2]=a[2]}return e},loadImage:function(e,t,n,r){this._progressEvent=t,this._completeEvent=n,this.source=e?e:this.source,typeof this.source=="object"?(this.image=this.source,this.width=this.image.width,this.height=this.image.height,this.isLoading=!1,this.loadComplete=!0,this.type==="clip"?this._setFrames(r):(this._completeEvent&&this._completeEvent.apply(this,[this]),r&&this.parent&&this.draw(this.parent.ctx))):this._load(r)},_load:function(e){var t=navigator.userAgent.toLowerCase(),n=/msie\s\d+\.\d+/;if(n.test(t)){var r=new Image;r.caller=this,r.show=e,this._loadStart(),r.addEventListener("load",this._loadComplete,!1),r.src=this.source}else{var i=new XMLHttpRequest;i.caller=this,i.show=e,i.onloadstart=this._loadStart,i.onprogress=this._loadProgress,i.onload=this._loadComplete,i.open("GET",this.source,!0),i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null)}},_loadStart:function(){this.loadComplete=!1},_loadProgress:function(e){this.caller._progressEvent&&this.caller._progressEvent.apply(this.caller,[e]),this.caller.isLoading=!0,this.caller.loadComplete=!1},_loadComplete:function(e){var t=navigator.userAgent.toLowerCase(),n=/msie\s\d+\.\d+/;n.test(t)?(this.caller.image=this,this.caller.width=this.caller.image.width,this.caller.height=this.caller.image.height,this.caller.isLoading=!1,this.caller.loadComplete=!0,this.caller.type==="clip"?this.caller._setFrames(this.show):(this.caller._completeEvent&&this.caller._completeEvent.apply(this.caller,[this.caller]),this.show&&this.caller.parent&&this.caller.draw(this.caller.parent.ctx))):this.caller._base64Encode(this.responseText,this.caller,this.show)},_base64Encode:function(e,t,n){function d(e){if(e){var r=new Image;r.onload=function(){t.image=r,t.width=t.image.width,t.height=t.image.height,t.isLoading=!1,t.loadComplete=!0,t.type==="clip"?t._setFrames(n):(t._completeEvent&&t._completeEvent.apply(t,[t]),n&&t.parent&&t.draw(t.parent.ctx))};var s=t.source.split("."),o=s[s.length-1]==="jpg"?"jpeg":s[s.length-1];r.src="data:image/"+o+";base64,"+i}}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",s=0;while(s<e.length){var o=e.charCodeAt(s++)&255,u=e.charCodeAt(s++)&255,a=e.charCodeAt(s++)&255,f=o>>2,l=(o&3)<<4|u>>4,c,h;isNaN(u)?c=h=64:(c=(u&15)<<2|a>>6,isNaN(a)?h=64:h=a&63),i+=r.charAt(f)+r.charAt(l)+r.charAt(c)+r.charAt(h);var p=s<e.length?!1:!0;d(p)}},_setFrames:function(e){function o(){s.frameList[this.indice].data=this,this.indice===s.frameList.length-1&&(s._completeEvent&&s._completeEvent.apply(s,[s]),e&&s.parent&&s.draw(s.parent.ctx))}if(!this.frameList||this.type!=="clip")return;var t=document.createElement("canvas"),n,r,i,s=this;for(r=0;r<this.frameList.length;r++){t.width=this.frameList[r].map.width,t.height=this.frameList[r].map.height,this.width=this.frameList[r].map.width,this.height=this.frameList[r].map.height,n=t.getContext("2d"),n.drawImage(this.image,this.frameList[r].map.x,this.frameList[r].map.y,t.width,t.height,0,0,t.width,t.height),i=t.toDataURL("image/png");var u=new Image;u.indice=r,u.onload=o,u.src=i,n.clearRect(0,0,t.width,t.height)}},_setStyle:function(e,t,n,r,i,s){this.color=e instanceof Array?this._parseColor(e):e,this.lineColor=t instanceof Array?this._parseColor(t):t,this.lineCap=this._capList[r]?r:"butt",this.lineJoin=this
._joinList[i]?i:"miter",this.lineWidth=n?n:1,this.lineMiter=parseInt(s)?parseInt(s):10},_setLineStyle:function(e){this.lineGradient?this.lineShadow?(e.save(),e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.miterLimit=this.lineMiter,e.shadowColor=this.lineShadow.color,e.shadowOffsetX=this.lineShadow.offsetX,e.shadowOffsetY=this.lineShadow.offsetY,e.shadowBlur=this.lineShadow.blur,this._setLineGradient(e),e.restore()):(e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.miterLimit=this.lineMiter,this._setLineGradient(e)):this.lineShadow?(e.save(),e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.miterLimit=this.lineMiter,e.shadowColor=this.lineShadow.color,e.shadowOffsetX=this.lineShadow.offsetX,e.shadowOffsetY=this.lineShadow.offsetY,e.shadowBlur=this.lineShadow.blur,this.lineColor&&(e.globalAlpha=this._g.lineAlpha,e.strokeStyle=this.lineColor,e.stroke()),e.restore()):(e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.miterLimit=this.lineMiter,this.lineColor&&(e.globalAlpha=this._g.lineAlpha,e.strokeStyle=this.lineColor,e.stroke()))},_setFillStyle:function(e){this.gradient?this.shadow?(e.save(),e.shadowColor=this.shadow.color,e.shadowOffsetX=this.shadow.offsetX,e.shadowOffsetY=this.shadow.offsetY,e.shadowBlur=this.shadow.blur,this._setGradient(e),e.restore()):this._setGradient(e):this.shadow?(e.save(),e.shadowColor=this.shadow.color,e.shadowOffsetX=this.shadow.offsetX,e.shadowOffsetY=this.shadow.offsetY,e.shadowBlur=this.shadow.blur,this.color&&(e.fillStyle=this.color,e.fill()),e.restore()):this.color&&(e.fillStyle=this.color,e.fill())},_setFont:function(e,t,n,r,i){this.fontWeigth=e?e:this.fontWeigth,this.fontStyle=this.fontWeigth+" "+t.toString()+"px "+n,this.fontType=n,this.fontSize=t,this.align=this._alignList[r]?r:"center",this.baseLine=this._baseList[i]?i:"alphabetic"},_setShadow:function(e){this.shadow&&(e.shadowColor=this.shadow.color,e.shadowOffsetX=this.shadow.offsetX,e.shadowOffsetY=this.shadow.offsetY,e.shadowBlur=this.shadow.blur)},_setLineShadow:function(e){this.lineShadow&&(e.shadowColor=this.lineShadow.color,e.shadowOffsetX=this.lineShadow.offsetX,e.shadowOffsetY=this.lineShadow.offsetY,e.shadowBlur=this.lineShadow.blur)},_setGradient:function(e){var t,n=this.gradient;n.type==="linear"?t=e.createLinearGradient(n.coord.x0,n.coord.y0,n.coord.x1,n.coord.y1):n.type==="radial"&&(t=e.createRadialGradient(n.coord.x0,n.coord.y0,n.coord.r0,n.coord.x1,n.coord.y1,n.coord.r1));for(var r=0;r<n.color.length;r++)t.addColorStop(n.offset[r],n.color[r]);e.fillStyle=t,e.fill()},_setLineGradient:function(e){var t,n=this.lineGradient;n.type==="linear"?t=e.createLinearGradient(n.coord.x0,n.coord.y0,n.coord.x1,n.coord.y1):n.type==="radial"&&(t=e.createRadialGradient(n.coord.x0,n.coord.y0,n.coord.r0,n.coord.x1,n.coord.y1,n.coord.r1));for(var r=0;r<n.color.length;r++)t.addColorStop(n.offset[r],n.color[r]);e.stokeStyle=t,e.stroke()},_drawRect:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,e.beginPath(),e.rect(this.localX,this.localY,this.width,this.height),e.closePath(),t||(this._setFillStyle(e),this._setLineStyle(e)),e.restore(),this.mask&&e.clip()},_drawRoundRect:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,e.beginPath();var n,r,i,s;n=this.localX+(this.width-this.radius),r=this.localX+this.width,i=this.localY+(this.height-this.radius),s=this.localY+this.height,e.moveTo(this.localX+this.radius,this.localY),e.lineTo(n,this.localY),e.quadraticCurveTo(r,this.localY,r,this.localY+this.radius),e.lineTo(this.localX+this.width,i),e.quadraticCurveTo(r,s,n,this.localY+this.height),e.lineTo(this.localX+this.radius,s),e.quadraticCurveTo(this.localX,s,this.localX,i),e.lineTo(this.localX,this.localY+this.radius),e.quadraticCurveTo(this.localX,this.localY,this.localX+this.radius,this.localY),e.closePath(),t||(this._setFillStyle(e),this._setLineStyle(e)),e.restore(),this.mask&&e.clip()},_drawPolygon:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,e.beginPath();var n=[],r=[];for(var i=0;i<this.points.length;i++)i===0?e.moveTo(this.localX+this.points[i][0],this.localY+this.points[i][1]):e.lineTo(this.points[i][0]+this.localX,this.points[i][1]+this.localY),n.push(this.points[i][0]+this.localX),r.push(this.points[i][1]+this.localY);this.close&&e.closePath();if(!t){this._setFillStyle(e),this._setLineStyle(e);function s(e,t){return e>0?t-e:t<0?Math.abs(e+t):Math.abs(e)+t}n.sort(function(e,t){return e-t}),r.sort(function(e,t){return e-t}),this.width=s(n[0],n[n.length-1]),this.height=s(r[0],r[r.length-1]),this._coord={x:n,y:r}}e.restore(),this.mask&&e.clip()},_drawShape:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,e.beginPath();var n=[],r=[];for(var i=0;i<this.obj.length;i++)for(var s in this.obj[i]){var o=this.obj[i][s];switch(s){case"moveTo":e.moveTo(this.localX+o[0],this.localY+o[1]),n.push(this.localX+o[0]),r.push(this.localY+o[1]);break;case"lineTo":e.lineTo(this.localX+o[0],this.localY+o[1]),n.push(this.localX+o[0]),r.push(this.localY+o[1]);break;case"quadraticCurveTo":e.quadraticCurveTo(this.localX+o[0],this.localY+o[1],this.localX+o[2],this.localY+o[3]),n.push(this.localX+o[0]),r.push(this.localY+o[1]),n.push(this.localX+o[2]),r.push(this.localY+o[3]);break;case"bezierCurveTo":e.bezierCurveTo(this.localX+o[0],this.localY+o[1],this.localX+o[2],this.localY+o[3],this.localX+o[4],this.localY+o[5]),n.push(this.localX+o[0]),r.push(this.localY+o[1]),n.push(this.localX+o[2]),r.push(this.localY+o[3]),n.push(this.localX+o[4]),r.push(this.localY+o[5]);break;case"arcTo":e.arcTo(this.localX+o[0],this.localY+o[1],this.localX+o[2],this.localY+o[3],o[4]),n.push(this.localX+o[0]),r.push(this.localY+o[1]),n.push(this.localX+o[2]),r.push(this.localY+o[3]);break;default:}}this.close&&e.closePath();if(!t){this._setFillStyle(e),this._setLineStyle(e);function u(e,t){return e>0?t-e:t<0?Math.abs(e+t):Math.abs(e)+t}n.sort(function(e,t){return e-t}),r.sort(function(e,t){return e-t}),this.width=u(n[0],n[n.length-1]),this.height=u(r[0],r[r.length-1]),this._coord={x:n,y:r}}e.restore(),this.mask&&e.clip()},_drawLine:function(e,t){function s(e,t){return e-t}function o(e,t){return e>0?t-e:t<0?Math.abs(e+t):Math.abs(e)+t}e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,e.beginPath(),e.moveTo(this.points[0][0]+this.localX,this.points[0][1]+this.localY),e.lineTo(this.points[1][0]+this.localX,this.points[1][1]+this.localY),e.closePath(),this._setLineStyle(e);var n=[],r=[];for(var i=0;i<this.points.length;i++)n.push(this.points[i][0]+this.localX),r.push(this.points[i][1]+this.localY);n.sort(s),r.sort(s),this.width=o(n[0],n[n.length-1]),this.height=o(r[0],r[r.length-1]),this._coord={x:n,y:r},this.len=Math.sqrt(Math.pow(n[0]+n[1],2)+Math.pow(r[0]+r[1],2)),e.restore()},_drawCircle:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,e.beginPath(),e.arc(this.localX,this.localY,this.radius,this.startAngle,this.endAngle,!1),e.closePath(),t||(this._setFillStyle(e),this._setLineStyle(e)),e.restore(),this.mask&&e.clip()},_drawText:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,this.fontStyle=this.fontWeigth+" "+this.fontSize+"px "+this.fontType,e.font=this.fontStyle,e.textAlign=this.align,e.textBaseline=this.baseLine;var n=this.height/7,r=0;switch(this.baseLine){case"top":n=-(this.height/7);break;case"hanging":n=-(this.height/7);break;case"middle":n=this.height/7*3.5;break;case"alphabetic":n=this.height/7*5.8;break;case"ideographic":n=this.height;break;case"bottom":n=this.height;break;default:n=0}var i=e.measureText(this.txt);this.width=i.width+this.paddingLeft;if(this.align==="center")r=this.width/2;else if(this.align==="right"||this.align==="end")r=this.width;e.beginPath(),e.rect(this.localX-r-this.paddingLeft,this.localY-n-this.paddingTop,this.width+this.paddingLeft*2,this.height+this.paddingTop*2),e.closePath(),this.backGround&&(t?e.fill():(this.backGround.color&&(e.fillStyle=this.backGround.color,e.fill()),this.backGround.lineColor&&(e.lineWidth=this.backGround.lineWidth?this.backGround.lineWidth:2,e.strokeStyle=this.backGround.lineColor,e.stroke()))),t||(e.beginPath(),this.color&&(this.gradient?(e.save(),this.shadow&&this._setShadow(e),this._setGradient(e),e.fillText(this.txt,this.localX,this.localY),e.restore()):(e.save(),this.shadow&&this._setShadow(e),e.fillStyle=this.color,e.fillText(this.txt,this.localX,this.localY),e.restore())),this.lineColor&&(e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.miterLimit=this.lineMiter,e.strokeStyle=this.lineColor,this.lineGradient?(e.save(),this.lineShadow&&this._setLineShadow(e),this._setLineGradient(e),e.strokeText(this.txt,this.localX,this.localY),e.restore()):(e.save(),this.lineShadow&&this._setLineShadow(e),e.strokeStyle=this.lineColor,e.strokeText(this.txt,this.localX,this.localY),e.restore())),e.closePath()),e.restore(),this.mask&&e.clip()},_drawImage:function(e,t){e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha;if(this.loadComplete&&this.image){this.width=this.imageCrop.dw===-1?this.width:this.imageCrop.dw,this.height=this.imageCrop.dh===-1?this.height:this.imageCrop.dh,e.beginPath(),e.rect(this.localX-this.paddingLeft,this.localY-this.paddingTop,this.width+this.paddingLeft*2,this.height+this.paddingTop*2),e.closePath();if(!t){this._setFillStyle(e),this._setLineStyle(e),this._setShadow(e),e.beginPath();if(!this.doneimage){this.doneimage=!0,this.currentFilter=null;var n=document.createElement("canvas");n.width=this.width,n.height=this.height;var r=n.getContext("2d");r.drawImage(this.image,this.imageCrop.dx,this.imageCrop.dy,this.width,this.height,0,0,this.width,this.height),this.imageData=n,this.backUpImage=n}e.drawImage(this.imageData,this.localX,this.localY,this.width,this.height),e.closePath()}}e.restore()},_drawClip:function(e,t){if(!this.frameList)return;e.save(),e.translate(this.x,this.y),e.scale(this.scaleX,this.scaleY),e.rotate(this.rotation),e.globalAlpha=this._g.alpha,this.loadComplete&&this.image&&this.frameList[this.currentFrame].data&&(e.beginPath(),e.rect(this.localX,this.localY,this.frameList[this.currentFrame].map.width,this.frameList[this.currentFrame].map.height),e.closePath(),t||(this._setFillStyle(e),this._setLineStyle(e),this._setShadow(e),e.beginPath(),e.drawImage(this.frameList[this.currentFrame].data,this.localX+this.frameList[this.currentFrame].x,this.localY+this.frameList[this.currentFrame].y),e.closePath())),e.restore()},_global:function(){var e=this.parent._global();return{x:this.x,y:this.y,scaleX:this.scaleX,scaleY:this.scaleY,rotation:e.rotation+this.rotation,alpha:e.alpha<1?this.alpha*e.alpha:this.alpha,lineAlpha:e.alpha<1?this.lineAlpha*e.alpha:this.lineAlpha,visible:e.visible?this.visible:!1}},draw:function(e,t){this._g=this._global();if(!this._g.visible)return;switch(this.type){case"rect":this._drawRect(e,t);break;case"rectround":this._drawRoundRect(e,t);break;case"polygon":this._drawPolygon(e,t);break;case"shape":this._drawShape(e,t);break;case"line":this._drawLine(e,t);break;case"circle":this._drawCircle(e,t);break;case"text":this._drawText(e,t);break;case"img":this._drawImage(e,t);break;case"clip":this._drawClip(e,t);break;default:console.log("default displayObject")}}},Canvas2d.Tweener=function(){this.children={},this._tempChildren={},this.charList=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"," ","0","1","2","3","4","5","6","7","8","9",",",'"',"'",",",":",";","(",")","[","]","{","}","*","@",".","!","?","\\","/","<",">","#","+","-","_","=","^","ì","è","é","ò","à","ù","&","$","£","|","∞","°","ç"]},Canvas2d.Tweener.prototype={getFrame:function(){return window.rqanim.getFrame()},getTime:function(){return window.rqanim.getTime()},getFps:function(){return window.rqanim.getFps()},getTimeInterval:function(){return window.rqanim.getTimeInterval()},addTweener:function(e,t){if(e.parent===null||e.parent===undefined){console.log(typeof e.parent,"provide a nested object");return}var n={},r=["x","y","width","height","rotation","scaleX","scaleY","lineWidth","fontSize","radius","startAngle","endAngle"],i,s,o,u,a,f,l,c,h,p,d=t.data?t.data:null,v=t.delay?t.delay:0,m=t.ease?t.ease:"easeNone",g=t.duration?t.duration:1e3;for(var y in t)for(var b=0;b<r.length;b++)y===r[b]&&(i=t[y]>e[y]?t[y]-e[y]:-(e[y]-t[y]),n[y]={ease:m,to:i,ct:0,d:g,from:e[y],prop:y,request:t[y],target:e});if("obj"in t){if(!e.obj)return;n.obj={ease:m,to:[],ct:0,d:g,from:[],prop:"obj",subprop:[],index:[],request:[],target:e};for(var w in t.obj)for(var E in t.obj[w])for(var S=0;S<t.obj[w][E].length;S++)n.obj.index.push(parseInt(w)),n.obj.request.push(t.obj[w][E][S]),n.obj.from.push(e.obj[w][E][S]),i=t.obj[w][E][S]>e.obj[w][E][S]?t.obj[w][E][S]-e.obj[w][E][S]:-(e.obj[w][E][S]-t.obj[w][E][S]),n.obj.to.push(i),n.obj.subprop.push(E)}if("txt"in t){if(e.txt==="")return;t.txt=t.txt!==""?t.txt:"cutFwd",o=[];var x=[];u=e.txt;for(y=0;y<this.charList.length;y++)x.push(this.charList[y]);x=this._shuffle(x);for(y=0;y<u.length;y++)for(i=0;i<x.length;i++)if(u.charAt(y)===x[i]){o.push(i);break}n.txt={ease:m,to:u.length,ct:0,d:g,from:0,prop:"txt",subprop:o,request:"",target:e,text:e.txt,type:t.txt,charlist:x},e._prevTxt=e.txt,e.txt=""}if("shadow"in t){if(!e.shadow)return;n.shadow={ease:m,to:[],ct:0,d:g,from:[],prop:"shadow",subprop:[],request:[],target:e};for(var w in t.shadow)w==="color"?(s=Colors.ParseColor(t.shadow[w]),p=Colors.ParseColor(e.shadow[w]),o=s[0]-p[0],u=s[1]-p[1],a=s[2]-p[2],n.shadow.to.push([o,u,a]),n.shadow.from.push([p[0],p[1],p[2]]),n.shadow.subprop.push(w),n.shadow.request.push(t.shadow[w])):(i=t.shadow[w]>e.shadow[w]?t.shadow[w]-e.shadow[w]:-(e.shadow[w]-t.shadow[w]),n.shadow.to.push(i),n.shadow.from.push(e.shadow[w]),n.shadow.subprop.push(w),n.shadow.request.push(t.shadow[w]))}if("lineShadow"in t){if(!e.lineShadow)return;n.lineShadow={ease:m,to:[],ct:0,d:g,from:[],prop:"lineShadow",subprop:[],request:[],target:e};for(var T in t.lineShadow)T==="color"?(s=Colors.ParseColor(t.lineShadow[T]),p=Colors.ParseColor(e.lineShadow[T]),o=s[0]-p[0],u=s[1]-p[1],a=s[2]-p[2],n.lineShadow.to.push([o,u,a]),n.lineShadow.from.push([p[0],p[1],p[2]]),n.lineShadow.subprop.push(T),n.lineShadow.request.push(t.lineShadow[T])):(i=t.lineShadow[T]>e.lineShadow[T]?t.lineShadow[T]-e.lineShadow[T]:-(e.lineShadow[T]-t.lineShadow[T]),n.lineShadow.to.push(i),n.lineShadow.from.push(e.lineShadow[T]),n.lineShadow.subprop.push(T),n.lineShadow.request.push(t.lineShadow[T]))}"color"in t&&(s=Colors.ParseColor(t.color),p=Colors.ParseColor(e.color),o=s[0]-p[0],u=s[1]-p[1],a=s[2]-p[2],n.rgb={ease:m,tor:o,tog:u,tob:a,ct:0,d:g,fromr:p[0],fromg:p[1],fromb:p[2],prop:"color",request:s,target:e}),"lineColor"in t&&(s=Colors.ParseColor(t.lineColor),p=Colors.ParseColor(e.lineColor),o=s[0]-p[0],u=s[1]-p[1],a=s[2]-p[2],n.rgbl={ease:m,tor:o,tog:u,tob:a,ct:0,d:g,fromr:p[0],fromg:p[1],fromb:p[2],prop:"lineColor",request:s,target:e}),"alpha"in t&&(f=t.alpha,c=f-e.alpha,n.alpha={ease:m,to:c,ct:0,d:g,from:e.alpha,prop:"alpha",request:f,target:e}),"lineAlpha"in t&&(f=t.lineAlpha>1?t.lineAlpha/100:t.lineAlpha,h=f-e.lineAlpha,n.lineAlpha={ease:m,to:h,ct:0,d:g,from:e.lineAlpha,prop:"lineAlpha",request:l,target:e});var N=t.onStart?t.onStart:null,C=t.onTween?t.onTween:null,k=t.onEnd?t.onEnd:null;n.state={start:!0,tweening:!1,end:!1,onStart:N,onTween:C,onEnd:k,target:e,duration:g,delay:v,data:d};if(v>0){this._tempChildren[e.id]="";var L=this;setTimeout(function(){e.id in L._tempChildren&&(delete L._tempChildren[e.id],L.children[e.id]=n)},v)}else this.children[e.id]=n,window.rqanim.addLoop(this,this._callTween)},removeTweener:function(e){e.id in this._tempChildren&&delete this._tempChildren[e.id],e.id in this.children&&(this.children[e.id].state.end=!0)},_shuffle:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},_callTween:function(e){var t={},n,r;for(var i in e.children){if(e.children[i].state.start)e._states(e.children[i].state),e.children[i].state.start=!1;else{if(e.children[i].state.end){e.children[i].state.tweening=!1,r=e.children[i].state,delete e.children[i],e._states(r);for(n in e.children);!e.children[i]&&!e.children[n]&&window.rqanim.removeLoop(e);continue}e.children[i].state.tweening=!0}e._states(e.children[i].state);for(var s in e.children[i])if(s!=="state"){var o=window.rqanim.getTimeInterval();s==="rgb"||s==="rgbl"?(e.children[i][s].ct+=o,e._tweenColor(e.children[i][s],e.children[i].state)):s==="shadow"||s==="lineShadow"?(e.children[i][s].ct+=o,e._tweenS(e.children[i][s],e.children[i].state)):s==="obj"?(e.children[i][s].ct+=o,e._tweenO(e.children[i][s],e.children[i].state)):s==="txt"?(e.children[i][s].ct+=o,e._tweenT(e.children[i][s],e.children[i].state)):(e.children[i][s].ct+=o,e._tween(e.children[i][s],e.children[i].state))}e.children[i].state.target.className==="DisplayObjects"?t[e.children[i].state.target.parent.id]=e.children[i].state.target.parent:t[e.children[i].state.target.id]=e.children[i].state.target}for(var u in t)t[u].draw()},_tweenColor:function(e,t){e.ct/e.d>=1&&(e.ct=1,e.d=1,t.end=!0);var n,r,i;n=this[e.ease](e.ct,e.fromr,e.tor,e.d),r=this[e.ease](e.ct,e.fromg,e.tog,e.d),i=this[e.ease](e.ct,e.fromb,e.tob,e.d),e.target[e.prop]="rgb("+Math.round(n)+","+Math.round(r)+","+Math.round(i)+")"},_tween:function(e,t){e.ct/e.d>=1&&(e.ct=1,e.d=1,t.end=!0);var n;n=this[e.ease](e.ct,e.from,e.to,e.d),e.target[e.prop]=n},_tweenS:function(e,t){e.ct/e.d>=1&&(e.ct=1,e.d=1,t.end=!0);for(var n=0;n<e.to.length;n++)if(e.subprop[n]==="color"){var r,i,s;r=this[e.ease](e.ct,e.from[n][0],e.to[n][0],e.d),i=this[e.ease](e.ct,e.from[n][1],e.to[n][1],e.d),s=this[e.ease](e.ct,e.from[n][2],e.to[n][2],e.d),e.target[e.prop][e.subprop[n]]="rgb("+Math.round(r)+","+Math.round(i)+","+Math.round(s)+")"}else{var o;o=this[e.ease](e.ct,e.from[n],e.to[n],e.d),e.target[e.prop][e.subprop[n]]=o}},_tweenO:function(e,t){e.ct/e.d>=1&&(e.ct=1,e.d=1,t.end=!0);for(var n=0;n<e.to.length;n++){var r;r=this[e.ease](e.ct,e.from[n],e.to[n],e.d),e.target[e.prop][e.index[n]][e.subprop[n]][n]=r}},_tweenT:function(e,t){e.ct/e.d>=1&&(e.ct=1,e.d=1,t.end=!0);var n;switch(e.type){case"cutFwd":n=Math.floor(this[e.ease](e.ct,e.from,e.to,e.d)),e.target[e.prop]=e.text.substr(0,n);break;case"cutBack":n=Math.floor(this[e.ease](e.ct,e.from,e.to,e.d)),e.target[e.prop]=e.text.substr(0,e.to-n);break;case"matrix":for(var r=0;r<e.subprop.length;r++)n=Math.floor(this[e.ease](e.ct,0,e.subprop[r],e.d)),n=n>this.charList.length-1?n-this.charList.length:n,e.request+=e.charlist[n];e.target[e.prop]=e.text=e.request,e.request="";break;default:}},_states:function(e){for(var t in e)switch(t){case"start":e[t]===!0&&e.onStart&&e.onStart.apply(e.target,[e]);break;case"tweening":e[t]===!0&&e.onTween&&e.onTween.apply(e.target,[e]);break;case"end":e[t]===!0&&e.onEnd&&e.onEnd.apply(e.target,[e]);break;default:}},easeNone:function(e,t,n,r,i){return n*e/r+t},easeSine:function(e,t,n,r,i){return t+n*Math.sin(Math.PI/r*e)},easeInQuad:function(e,t,n,r,i){return n*(e/=r)*e+t},easeOutQuad:function(e,t,n,r,i){return-n*(e/=r)*(e-2)+t},easeInOutQuad:function(e,t,n,r,i){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeOutInQuad:function(e,t,n,r,i){return e<r/2?this.easeOutQuad(e*2,t,n/2,r,i):this.easeInQuad(e*2-r,t+n/2,n/2,r,i)},easeInCubic:function(e,t,n,r,i){return n*(e/=r)*e*e+t},easeOutCubic:function(e,t,n,r,i){return n*((e=e/r-1)*e*e+1)+t},easeInOutCubic:function(e,t,n,r,i){return(e/=r/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t},easeOutInCubic:function(e,t,n,r,i){return e<r/2?this.easeOutCubic(e*2,t,n/2,r,i):this.easeInCubic(e*2-r,t+n/2,n/2,r,i)},easeInQuart:function(e,t,n,r,i){return n*(e/=r)*e*e*e+t},easeOutQuart:function(e,t,n,r,i){return-n*((e=e/r-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,n,r,i){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},easeOutInQuart:function(e,t,n,r,i){return e<r/2?this.easeOutQuart(e*2,t,n/2,r,i):this.easeInQuart(e*2-r,t+n/2,n/2,r,i)},easeInQuint:function(e,t,n,r,i){return n*(e/=r)*e*e*e*e+t},easeOutQuint:function(e,t,n,r,i){return n*((e=e/r-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,n,r,i){return(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},easeOutInQuint:function(e,t,n,r,i){return e<r/2?this.easeOutQuint(e*2,t,n/2,r,i):this.easeInQuint(e*2-r,t+n/2,n/2,r,i)},easeInSine:function(e,t,n,r,i){return-n*Math.cos(e/r*(Math.PI/2))+n+t},easeOutSine:function(e,t,n,r,i){return n*Math.sin(e/r*(Math.PI/2))+t},easeInOutSine:function(e,t,n,r,i){return-n/2*(Math.cos(Math.PI*e/r)-1)+t},easeOutInSine:function(e,t,n,r,i){return e<r/2?this.easeOutSine(e*2,t,n/2,r,i):this.easeInSine(e*2-r,t+n/2,n/2,r,i)},easeInExpo:function(e,t,n,r,i){return e===0?t:n*Math.pow(2,10*(e/r-1))+t-n*.001},easeOutExpo:function(e,t,n,r,i){return e===r?t+n:n*1.001*(-Math.pow(2,-10*e/r)+1)+t},easeInOutExpo:function(e,t,n,r,i){return e===0?t:e===r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t-n*5e-4:n/2*1.0005*(-Math.pow(2,-10*--e)+2)+t},easeOutInExpo:function(e,t,n,r,i){return e<r/2?this.easeOutExpo(e*2,t,n/2,r,i):this.easeInExpo(e*2-r,t+n/2,n/2,r,i)},easeInCirc:function(e,t,n,r,i){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t},easeOutCirc:function(e,t,n,r,i){return n*Math.sqrt(1-(e=e/r-1)*e)+t},easeInOutCirc:function(e,t,n,r,i){return(e/=r/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeOutInCirc:function(e,t,n,r,i){return e<r/2?this.easeOutCirc(e*2,t,n/2,r,i):this.easeInCirc(e*2-r,t+n/2,n/2,r,i)},easeInElastic:function(e,t,n,r,i){if(e===0)return t;if((e/=r)===1)return t+n;var s=!i||isNaN(i.period)?r*.3:i.period,o,u=!i||isNaN(i.amplitude)?0:i.amplitude;return!u||u<Math.abs(n)?(u=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/u),-(u*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t},easeOutElastic:function(e,t,n,r,i){if(e===0)return t;if((e/=r)===1)return t+n;var s=!i||isNaN(i.period)?r*.3:i.period,o,u=!i||isNaN(i.amplitude)?0:i.amplitude;return!u||u<Math.abs(n)?(u=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/u),u*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t},easeInOutElastic:function(e,t,n,r,i){if(e===0)return t;if((e/=r/2)===2)return t+n;var s=!i||isNaN(i.period)?r*.3*1.5:i.period,o,u=!i||isNaN(i.amplitude)?0:i.amplitude;return!u||u<Math.abs(n)?(u=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/u),e<1?-0.5*u*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:u*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t},easeOutInElastic:function(e,t,n,r,i){return e<r/2?this.easeOutElastic(e*2,t,n/2,r,i):this.easeInElastic(e*2-r,t+n/2,n/2,r,i)},easeInBack:function(e,t,n,r,i){var s=!i||isNaN(i.overshoot)?1.70158:i.overshoot;return n*(e/=r)*e*((s+1)*e-s)+t},easeOutBack:function(e,t,n,r,i){var s=!i||isNaN(i.overshoot)?1.70158:i.overshoot;return n*((e=e/r-1)*e*((s+1)*e+s)+1)+t},easeInOutBack:function(e,t,n,r,i){var s=!i||isNaN(i.overshoot)?1.70158:i.overshoot;return(e/=r/2)<1?n/2*e*e*(((s*=1.525)+1)*e-s)+t:n/2*((e-=2)*e*(((s*=1.525)+1)*e+s)+2)+t},easeOutInBack:function(e,t,n,r,i){return e<r/2?this.easeOutBack(e*2,t,n/2,r,i):this.easeInBack(e*2-r,t+n/2,n/2,r,i)},easeInBounce:function(e,t,n,r,i){return n-this.easeOutBounce(r-e,0,n,r)+t},easeOutBounce:function(e,t,n,r,i){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(e,t,n,r,i){return e<r/2?this.easeInBounce(e*2,0,n,r)*.5+t:this.easeOutBounce(e*2-r,0,n,r)*.5+n*.5+t},easeOutInBounce:function(e,t,n,r,i){return e<r/2?this.easeOutBounce(e*2,t,n/2,r,i):this.easeInBounce(e*2-r,t+n/2,n/2,r,i)}};var Colors={Rgb:function(e){return[this._toR(e),this._toG(e),this._toB(e)]},_toR:function(e){return parseInt(this._cutHex(e).substring(0,2),16)},_toG:function(e){return parseInt(this._cutHex(e).substring(2,4),16)},_toB:function(e){return parseInt(this._cutHex(e).substring(4,6),16)},_cutHex:function(e){return e.charAt(0)==="#"?e.substring(1,7):e},Hex:function(e){return"#"+this._toHex(e[0])+this._toHex(e[1])+this._toHex(e[2])},_toHex:function(e){return e===null?"00":(e=parseInt(e),e===0||isNaN(e)?"00":(e=Math.max(0,e),e=Math.min(e,255),e=Math.round(e),"0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16)))},RgbToHsl:function(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=(r+i)/2;if(r===i)s=o=0;else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s,o,u]},HslToRgb:function(e,t,n){var r,i,s;if(t===0)r=i=s=n;else{function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]},RgbToHsv:function(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=r,a=r-i;o=r===0?0:a/r;if(r===i)s=0;else{switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s,o,u]},HsvToRgb:function(e,t,n){var r,i,s,o=Math.floor(e*6),u=e*6-o,a=n*(1-t),f=n*(1-u*t),l=n*(1-(1-u)*t);switch(o%6){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;case 5:r=n,i=a,s=f}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]},RandomRgb:function(e){var t=e?e:"string",n=Math.round(Math.random()*255),r=Math.round(Math.random()*255),i=Math.round(Math.random()*255);return t==="array"?[Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255)]:"rgb("+n+","+r+","+i+")"},ParseColor:function(e){if(!e)return[0,0,0];if(typeof e=="string"){var t=e.replace(/\s/g,"").toLowerCase(),n,r;if(t.indexOf("rgb")>-1)return n=/\-?(\d{1,3}),\-?(\d{1,3}),\-?(\d{1,3})/g,r=n.exec(t),[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];if(t.indexOf("#")>-1){var i=this.Rgb(t);return i}if(t.indexOf("hsl")>-1){n=/hsl\((.*),(\d{1,3})?%,(\d{1,3})/g,r=n.exec(t);var s=this.HslToRgb(r[1]/360,r[2]/100,r[3]/100);return s}if(t.indexOf("hsv")>-1){n=/hsv\((.*),(\d{1,3})?%,(\d{1,3})/g,r=n.exec(t);var o=this.HsvToRgb(r[1]/360,r[2]/100,r[3]/100);return o}return t in this.namedColor?(r=this.namedColor[t][1],r):[0,0,0]}return e},Invert:function(e){var t=this.ParseColor(e);return[255-t[0],255-t[1],255-t[2]]},namedColor:{aliceblue:["#f0f8ff",[240,248,255]],antiquewhite:["#faebd7",[250,235,215]],aqua:["#00ffff",[0,255,255]],aquamarine:["#7fffd4",[127,255,212]],azure:["#f0ffff",[240,255,255]],beige:["#f5f5dc",[245,245,220]],bisque:["#ffe4c4",[255,228,196]],black:["#000000",[0,0,0]],blanchedalmond:["#ffebcd",[255,235,205]],blue:["#0000ff",[0,0,255]],blueviolet:["#8a2be2",[138,43,226]],brown:["#a52a2a",[165,42,42]],burlywood:["#deb887",[222,184,135]],cadetblue:["#5f9ea0",[95,158,160]],chartreuse:["#7fff00",[127,255,0]],chocolate:["#d2691e",[210,105,30]],coral:["#ff7f50",[255,127,80]],cornflowerblue:["#6495ed",[100,149,237]],cornsilk:["#fff8dc",[255,248,220]],crimson:["#dc143c",[220,20,60]],cyan:["#00ffff",[0,255,255]],darkblue:["#00008b",[0,0,139]],darkcyan:["#008b8b",[0,139,139]],darkgoldenrod:["#b8860b",[184,134,11]],darkgray:["#a9a9a9",[169,169,169]],darkgreen:["#006400",[0,100,0]],darkgrey:["#a9a9a9",[169,169,169]],darkkhaki:["#bdb76b",[189,183,107]],darkmagenta:["#8b008b",[139,0,139]],darkolivegreen:["#556b2f",[85,107,47]],darkorange:["#ff8c00",[255,140,0]],darkorchid:["#9932cc",[153,50,204]],darkred:["#8b0000",[139,0,0]],darksalmon:["#e9967a",[233,150,122]],darkseagreen:["#8fbc8f",[143,188,143]],darkslateblue:["#483d8b",[72,61,139]],darkslategray:["#2f4f4f",[47,79,79]],darkslategrey:["#2f4f4f",[47,79,79]],darkturquoise:["#00ced1",[0,206,209]],darkviolet:["#9400d3",[148,0,211]],deeppink:["#ff1493",[255,20,147]],deepskyblue:["#00bfff",[0,191,255]],dimgray:["#696969",[105,105,105]],dimgrey:["#696969",[105,105,105]],dodgerblue:["#1e90ff",[30,144,255]],firebrick:["#b22222",[178,34,34]],floralwhite:["#fffaf0",[255,250,240]],forestgreen:["#228b22",[34,139,34]],fuchsia:["#ff00ff",[255,0,255]],gainsboro:["#dcdcdc",[220,220,220]],ghostwhite:["#f8f8ff",[248,248,255]],gold:["#ffd700",[255,215,0]],goldenrod:["#daa520",[218,165,32]],gray:["#808080",[128,128,128]],green:["#008000",[0,128,0]],greenyellow:["#adff2f",[173,255,47]],grey:["#808080",[128,128,128]],honeydew:["#f0fff0",[240,255,240]],hotpink:["#ff69b4",[255,105,180]],indianred:["#cd5c5c",[205,92,92]],indigo:["#4b0082",[75,0,130]],ivory:["#fffff0",[255,255,240]],khaki:["#f0e68c",[240,230,140]],lavender:["#e6e6fa",[230,230,250]],lavenderblush:["#fff0f5",[255,240,245]],lawngreen:["#7cfc00",[124,252,0]],lemonchiffon:["#fffacd",[255,250,205]],lightblue:["#add8e6",[173,216,230]],lightcoral:["#f08080",[240,128,128]],lightcyan:["#e0ffff",[224,255,255]],lightgoldenrodyellow:["#fafad2",[250,250,210]],lightgray:["#d3d3d3",[211,211,211]],lightgreen:["#90ee90",[144,238,144]],lightgrey:["#d3d3d3",[211,211,211]],lightpink:["#ffb6c1",[255,182,193]],lightsalmon:["#ffa07a",[255,160,122]],lightseagreen:["#20b2aa",[32,178,170]],lightskyblue:["#87cefa",[135,206,250]],lightslategray:["#778899",[119,136,153]],lightslategrey:["#778899",[119,136,153]],lightsteelblue:["#b0c4de",[176,196,222]],lightyellow:["#ffffe0",[255,255,224]],lime:["#00ff00",[0,255,0]],limegreen:["#32cd32",[50,205,50]],linen:["#faf0e6",[250,240,230]],magenta:["#ff00ff",[255,0,255]],maroon:["#800000",[128,0,0]],mediumaquamarine:["#66cdaa",[102,205,170]],mediumblue:["#0000cd",[0,0,205]],mediumorchid:["#ba55d3",[186,85,211]],mediumpurple:["#9370db",[147,112,219]],mediumseagreen:["#3cb371",[60,179,113]],mediumslateblue:["#7b68ee",[123,104,238]],mediumspringgreen:["#00fa9a",[0,250,154]],mediumturquoise:["#48d1cc",[72,209,204]],mediumvioletred:["#c71585",[199,21,133]],midnightblue:["#191970",[25,25,112]],mintcream:["#f5fffa",[245,255,250]],mistyrose:["#ffe4e1",[255,228,225]],moccasin:["#ffe4b5",[255,228,181]],navajowhite:["#ffdead",[255,222,173]],navy:["#000080",[0,0,128]],oldlace:["#fdf5e6",[253,245,230]],olive:["#808000",[128,128,0]],olivedrab:["#6b8e23",[107,142,35]],orange:["#ffa500",[255,165,0]],orangered:["#ff4500",[255,69,0]],orchid:["#da70d6",[218,112,214]],palegoldenrod:["#eee8aa",[238,232,170]],palegreen:["#98fb98",[152,251,152]],paleturquoise:["#afeeee",[175,238,238]],palevioletred:["#db7093",[219,112,147]],papayawhip:["#ffefd5",[255,239,213]],peachpuff:["#ffdab9",[255,218,185]],peru:["#cd853f",[205,133,63]],pink:["#ffc0cb",[255,192,203]],plum:["#dda0dd",[221,160,221]],powderblue:["#b0e0e6",[176,224,230]],purple:["#800080",[128,0,128]],red:["#ff0000",[255,0,0]],rosybrown:["#bc8f8f",[188,143,143]],royalblue:["#4169e1",[65,105,225]],saddlebrown:["#8b4513",[139,69,19]],salmon:["#fa8072",[250,128,114]],sandybrown:["#f4a460",[244,164,96]],seagreen:["#2e8b57",[46,139,87]],seashell:["#fff5ee",[255,245,238]],sienna:["#a0522d",[160,82,45]],silver:["#c0c0c0",[192,192,192]],skyblue:["#87ceeb",[135,206,235]],slateblue:["#6a5acd",[106,90,205]],slategray:["#708090",[112,128,144]],slategrey:["#708090",[112,128,144]],snow:["#fffafa",[255,250,250]],springgreen:["#00ff7f",[0,255,127]],steelblue:["#4682b4",[70,130,180]],tan:["#d2b48c",[210,180,140]],teal:["#008080",[0,128,128]],thistle:["#d8bfd8",[216,191,216]],tomato:["#ff6347",[255,99,71]],turquoise:["#40e0d0",[64,224,208]],violet:["#ee82ee",[238,130,238]],wheat:["#f5deb3",[245,222,179]],white:["#ffffff",[255,255,255]],whitesmoke:["#f5f5f5",[245,245,245]],yellow:["#ffff00",[255,255,0]],yellowgreen:["#9acd32",[154,205,50]]}};